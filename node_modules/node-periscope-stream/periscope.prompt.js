var request = require('request');
var prompt = require('prompt');

prompt.start();

function periscope(url) {
	var id = url.match(/periscope.tv\/w\/(.*)/i)[1];
	
	var api = 'https://api.periscope.tv/api/v2/getAccessPublic?token=' + id;
	
	request(api, function(error, response, body) {
		if (error || response.statusCode != 200) {
			console.log(response.statusCode);
			ask();
			return;
		}
		
		var obj = JSON.parse(body);
		var hls = obj['hls_url'];
		
		console.log(hls);
		
		ask();
	});
}

function ask() {
	prompt.get('URL', function(err, res) {
		periscope(res['URL']);
	});
};

ask();

module.exports = periscope;
